# Test Case: End-to-End System Workflow

## Objective
Verify the complete system workflow from customer requests to delivery completion.

## Test Scenario
- **System Setup:**
  - 1 Depot Agent at (0, 0)
  - 3 Vehicle Agents with different capacities and maxDistances
  - 4 Customer Agents at various locations
- **Test Flow:**
  1. Customers send requests to depot
  2. Depot checks inventory and queues requests
  3. Depot batches requests when threshold reached
  4. Depot solves VRP with constraints
  5. Depot sends routes to vehicles via Contract-Net
  6. Vehicles bid on routes
  7. Depot assigns routes to vehicles
  8. Vehicles complete deliveries
  9. Vehicles notify customers of delivery completion

## Test Steps
1. Start the system: `mvn exec:java -Dexec.mainClass="project.Main"`
2. Wait for customers to generate requests (30-60 seconds)
3. Observe depot batch processing
4. Observe vehicle bidding and route assignment
5. Wait for route completion (30 seconds)
6. Verify customer delivery notifications

## Expected Results
- All agents register with DF successfully
- Customers send requests to depot
- Depot processes requests and batches them
- VRP solver finds solution respecting constraints
- Vehicles bid on routes via Contract-Net
- Routes are assigned to vehicles
- Vehicles complete routes and notify customers
- System handles multiple batches

## Verification Checklist
- [ ] Depot agent started and registered with DF
- [ ] Vehicle agents started and registered with DF
- [ ] Customer agents started and registered with DF
- [ ] Customers send requests to depot
- [ ] Depot checks inventory and responds
- [ ] Requests are queued until batch threshold
- [ ] Batch processing triggers when threshold reached
- [ ] VRP solver executes and finds solution
- [ ] Solution respects capacity constraints
- [ ] Solution respects maximum distance constraints
- [ ] Solution prioritizes items delivered over distance
- [ ] Depot sends CFP messages to vehicles
- [ ] Vehicles bid on routes (or refuse if constraints violated)
- [ ] Depot accepts proposals and assigns routes
- [ ] Vehicles change state to "absent"
- [ ] Vehicles complete routes and change state to "free"
- [ ] Customers receive delivery completion notifications

## Example Console Output
```
✓ Depot Agent started: depot-agent
✓ Vehicle Agent started: vehicle-Vehicle1 (capacity: 50, maxDistance: 1000.0)
✓ Vehicle Agent started: vehicle-Vehicle2 (capacity: 40, maxDistance: 800.0)
✓ Vehicle Agent started: vehicle-Vehicle3 (capacity: 30, maxDistance: 600.0)
✓ Customer Agent started: customer-1 at (100.0, 150.0)

Customer Customer1: Requested 10 units of ItemA
Depot: ✓ Item available. Inventory: ItemA = 90
Depot: Request added to queue. Queue size: 1

=== Depot: Processing Batch ===
Batch size: 5
Depot: Found 3 available vehicles

=== OR-Tools CVRP Solver (Basic Requirements 1 & 2) ===
Solving CVRP with capacity and maximum distance constraints...
Objective: Maximize items delivered (primary), minimize distance (secondary)
Solution found in 245 ms!

=== Solution Summary ===
Total items delivered: 45/50
Total distance: 1250.50
Number of routes: 2

=== Depot: Contract-Net Route Assignment ===
Depot: Received proposal from vehicle-Vehicle1
Depot: Assigned route 1 to vehicle Vehicle1
Depot: All routes assigned via Contract-Net

Vehicle Vehicle1: Route accepted
Vehicle Vehicle1: State changed to 'absent' (delivering)

Vehicle Vehicle1: Route completed. Returning to free state.
Vehicle Vehicle1: Notified customer customer-1 about delivery completion
Customer Customer1: ✓✓✓ DELIVERY COMPLETE - Your order has been delivered by vehicle Vehicle1
```

## Notes
- System should handle multiple batches over time
- Vehicles should become available for new routes after completion
- Customers should receive notifications when deliveries are complete
- System should handle cases where not all items can be delivered

